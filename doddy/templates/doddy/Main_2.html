{% extends 'base.html' %}

{% block content %}
<body>
	<div class="wrapper">
	<!-- Header -->		
	<header id="header">
		<div class="header_site">
			<div class="row">
				<div class="steps_wrapp_2">
					<div class="steps_2">
						<div class="step_2">
							<p>1</p>
							<div class="line" style="background: #E94B4B"></div>
						</div>
						<div class="step_2">
							<p>2</p>
							<div class="line" style="background: #FFAC53"></div>
						</div>
						<div class="step_2">
							<p>3</p>
						</div>
						<div class="step_2">
							<p>4</p>
							<div class="line" style="background: #FFAC53"></div>
						</div>
						<div class="step_2">
							<p>5</p>
						</div>
						<div class="step_2">
							<p>6</p>
							<div class="line" style="background: #E94B4B"></div>
						</div>
						<div class="step_2">
							<p>7</p>
						</div>
					</div>
				</div>
				<div class="header_two_cols">
					<div>
						<div class="white_box_wrapp">
							<!-- <img class="angle_top" src="img/angle.svg" alt="" /> -->
							<div class="white_box">
								<div>
									<div class="circle"></div>
									<p>day of the week</p>
								</div>
								<div>
									<div class="circle orange"></div>
									<p>auction</p>
								</div>
								<div>
									<div class="circle red"></div>
									<p>big auction</p>
								</div>
							</div>
						</div>
					</div>
					<div>
						<p>MetaFarm1.0</p>
					</div>
				</div>
			</div>
		</div>
		<div class="header_border"></div>						
	</header>
	<!-- /Header -->
	<!-- Content -->
	<div class="content">
	<!-- Section 1 - Main_2 -->
	<section>
		<div class="row">
			<div class="boost_header">
				<h3>Your balance</h3>
				<div class="c_val">
					<svg width="62" height="62" viewBox="0 0 62 62" fill="none" xmlns="http://www.w3.org/2000/svg">
						<path d="M59.0262 23.0721L54.422 19.0544C53.5031 18.2528 52.8677 17.1873 52.594 16.0045L51.2254 10.0512C50.59 7.28476 48.0386 5.3981 45.2135 5.58383L39.1136 5.9944C37.9015 6.0726 36.6991 5.76956 35.6629 5.12438L30.4819 1.87893C28.0771 0.373515 24.9392 0.842736 23.0721 2.97378L19.0544 7.57802C18.2528 8.49691 17.1873 9.13232 16.0045 9.40603L10.0512 10.7746C7.28476 11.41 5.3981 13.9614 5.58383 16.7865L5.9944 22.8864C6.0726 24.0985 5.76956 25.3009 5.12438 26.3371L1.87893 31.5181C0.373515 33.9229 0.842736 37.0608 2.97378 38.9279L7.57802 42.9456C8.49691 43.7472 9.13232 44.8127 9.40603 45.9955L10.7746 51.9488C11.41 54.7152 13.9614 56.6019 16.7865 56.4162L22.8864 56.0056C24.0985 55.9274 25.3009 56.2304 26.3371 56.8756L31.5181 60.1211C33.9229 61.6265 37.0608 61.1573 38.9279 59.0262L42.9456 54.422C43.7472 53.5031 44.8127 52.8677 45.9955 52.594L51.9488 51.2254C54.7152 50.59 56.6019 48.0386 56.4162 45.2135L56.0056 39.1136C55.9274 37.9015 56.2304 36.6991 56.8756 35.6629L60.1211 30.4819C61.6265 28.0771 61.1573 24.9392 59.0262 23.0721Z" fill="#7777D4" stroke="black" stroke-linecap="round" stroke-linejoin="round"/>
					</svg>
					<p id="total-points">{{ user.total_balance }}</p>
				</div>
				<h4>
                    <span id="berries-per-sec">{{ user.berries_per_sec }}</span>
                    <span>/ s</span>
                </h4>
			</div>

			<div class="tables_items">
				<div class="tables_items_header">
					<div>
						<svg width="82" height="74" viewBox="0 0 82 74" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M80.8342 38.2352C80.3958 34.2825 79.0426 30.9028 76.8127 28.1754C74.5637 25.4381 71.5238 23.521 67.7786 22.4933C66.2825 22.0782 64.7959 21.8707 63.3474 21.8707C62.6708 21.8707 61.9846 21.9201 61.308 22.0091C60.4027 22.1375 59.5165 22.3352 58.6588 22.6217C57.3914 21.2086 55.819 20.1315 54.056 19.4694C53.8654 14.1727 50.3871 9.37991 45.1935 7.93714L44.8123 7.82844C43.8022 7.55174 42.7635 7.40351 41.7248 7.40351C37.0457 7.40351 32.8622 10.2298 30.9182 14.5086C31.3756 8.65852 27.7449 3.10486 22.0843 1.53363L21.7031 1.42492C20.693 1.14823 19.6542 1 18.6155 1C13.2122 1 8.45697 4.78479 7.06565 10.2001L1.78626 30.6755C0.680832 34.9742 0.738009 39.1246 1.97686 42.9984C3.19664 46.8326 5.41704 50.1628 8.58086 52.9001C11.5446 55.4694 15.2325 57.3766 19.5399 58.5723C22.3035 59.3332 24.9813 59.7285 27.5257 59.7285C28.4691 59.7285 29.403 59.6692 30.3274 59.5605C29.8509 65.4304 33.4721 71.0038 39.1518 72.5751C40.1619 72.8518 41.2006 73 42.2393 73C46.8231 73 50.9399 70.2726 52.9315 66.1419C53.9989 66.6854 55.1424 67.1301 56.3527 67.476C58.0394 67.9404 59.7071 68.1776 61.3176 68.1776C63.2711 68.1776 65.1675 67.8317 66.94 67.1499C70.161 65.9146 72.9246 63.6714 75.1736 60.4697C77.1367 57.6731 78.6805 54.1156 79.7764 49.8663C80.8723 45.6171 81.2344 41.7137 80.8532 38.2451L80.8342 38.2352Z" fill="#F0E9E4" stroke="black" stroke-linecap="round" stroke-linejoin="round"/>
							<path d="M12.5356 47.9887C10.2581 46.0123 8.69521 43.6802 7.83755 40.9923C6.97988 38.3044 6.9513 35.409 7.75178 32.3258L13.0216 11.8603C13.8507 8.6585 17.0145 6.76116 20.1021 7.61101L20.4833 7.71971C23.5709 8.57945 25.4006 11.8603 24.581 15.062L19.6161 34.3417C19.2445 35.7746 19.1587 37.0494 19.3493 38.1562C19.5399 39.2728 19.9973 40.2017 20.712 40.9626C21.4363 41.7137 22.4178 42.2671 23.6757 42.6129C24.9336 42.9588 26.0581 42.9983 27.0492 42.7118C28.0403 42.4252 28.8884 41.8619 29.5841 40.9923C30.2797 40.1227 30.8038 38.9764 31.1755 37.5435L36.1404 18.2638C36.9695 15.062 40.1333 13.1647 43.2209 14.0145L43.6021 14.1232C46.6897 14.983 48.5193 18.2638 47.6998 21.4655L42.4299 41.9311C41.639 45.0044 40.2286 47.4847 38.2083 49.3722C36.1785 51.2597 33.7104 52.485 30.7848 53.0285C27.8592 53.572 24.6477 53.3546 21.1408 52.3862C17.6911 51.4277 14.8227 49.9651 12.5452 47.9887H12.5356Z" fill="#FFC66B" stroke="black" stroke-linecap="round" stroke-linejoin="round"/>
							<path d="M51.1494 25.2404L51.4734 25.3294C54.4657 26.1595 56.2477 29.3513 55.4472 32.4543L55.695 32.5234C56.505 31.3376 57.458 30.3889 58.5443 29.6774C59.6307 28.9659 60.8219 28.5311 62.1179 28.3533C63.4044 28.1754 64.7672 28.2841 66.1775 28.6794C68.7029 29.381 70.685 30.5965 72.1145 32.3357C73.5439 34.0749 74.4111 36.2786 74.697 38.9566C74.9924 41.6346 74.697 44.7178 73.7917 48.1962V48.2259C72.8864 51.6945 71.6856 54.5108 70.1609 56.6849C68.6362 58.8589 66.8446 60.3412 64.7767 61.1317C62.7088 61.9223 60.4312 61.9717 57.9249 61.28C56.4669 60.8748 55.209 60.2621 54.1512 59.4419C53.0839 58.6217 52.2453 57.6434 51.6259 56.4971C51.0064 55.3607 50.6157 54.0859 50.4728 52.6925L50.2536 52.6332L47.8045 62.1298C46.9754 65.3316 43.8116 67.2289 40.724 66.3791C37.6364 65.5193 35.8068 62.2385 36.6263 59.0368L44.269 29.3612C45.0695 26.2583 48.1476 24.4104 51.1399 25.2404H51.1494ZM58.6301 50.5679C59.4973 50.2023 60.2501 49.5501 60.9077 48.6212C61.5652 47.6923 62.0798 46.5163 62.4515 45.0834V45.0538C62.8327 43.6011 62.9565 42.3066 62.8231 41.1603C62.6897 40.014 62.3371 39.0653 61.7558 38.3242C61.1745 37.583 60.4121 37.0691 59.4497 36.8023C58.4872 36.5355 57.5723 36.575 56.7051 36.9209C55.8379 37.2668 55.066 37.8992 54.4085 38.8281C53.7414 39.757 53.2173 40.9528 52.8361 42.4252V42.4548C52.4549 43.9075 52.3311 45.202 52.4645 46.3483C52.5979 47.4946 52.9505 48.4433 53.5318 49.1844C54.1131 49.9256 54.885 50.4394 55.8665 50.7063C56.8481 50.983 57.7724 50.9335 58.6301 50.5679Z" fill="#FF5252" stroke="black" stroke-linecap="round" stroke-linejoin="round"/>
						</svg>
					</div>
					<div>
						<div class="blue_tag_2">
							<p>amt</p>
						</div>
					</div>
				</div>
                {% for farm in farms %}
                    <div class="table_item buy-farm-button" data-farm-type-id="{{ farm.pk }}">
                        <div>
                            <div class="icon_box"></div>
                        </div>
                        <div>
                            <h3>{{ farm.name }}</h3>
                            <p>Each farm {{ farm.farm_per_sec }}/s</p>
                        </div>
                        <div>
                            <div class="bnts_inlines">
                                {% if farm.level > 0 %}
                                <div>
                                    <a href="#" class="pill_2 yellow">
                                        <p class="num">{{ farm.level }}</p>
                                        <p class="k">{{ farm.cost_to_upgrade }}</p>
                                    </a>
                                </div>
                                {% else %}
                                <div>
                                    <a href="#" class="pill_2">
                                        <p class="num">0</p>
                                        <p class="k">{{ farm.cost_to_upgrade }}</p>
                                    </a>
                                </div>
                                {% endif %}
                                {% if farm.level > 0 %}
                                <div>
                                    <a href="#" class="pill_2 blue">
                                        <p class="num">{{ farm.level }}</p>
                                        <p class="k">{{ farm.cost_to_upgrade }}</p>
                                    </a>
                                </div>
                                {% else %}
                                <div>
                                    <a href="#" class="pill_2">
                                        <p class="num">0</p>
                                        <p class="k">{{ farm.cost_to_upgrade }}</p>
                                    </a>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% endfor %}
			</div>
		</div>
	</section>
	<!-- /Section 1 - Main_2 -->
	</div>
	<!-- /Content -->
	<!-- Footer -->
    <footer class="footer_section">
{% endblock %}
{% block content1 %}
</body>
<script>
var berries_per_sec = {{ user.berries_per_sec }}


function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

function updateFarmLevel(farmId, newLevel) {
        // Find the table item by farm ID
        const farmElement = document.querySelector(`.table_item[data-farm-type-id="${farmId}"]`);

        if (!farmElement) {
            console.error("Farm not found");
            return;
        }

        // Find all pill_2 elements inside the farm element
        const pillElements = farmElement.querySelectorAll('.pill_2');

        if (pillElements.length === 0) {
            console.error("Pill elements not found");
            return;
        }

        // Update the first pill_2 element
        const firstPill = pillElements[0];
        const levelElement = firstPill.querySelector('.num');
        const costElement = firstPill.querySelector('.k');

        // Update level and cost
        const currentLevel = parseInt(levelElement.textContent);

        if (currentLevel === 0 && newLevel > 0) {
            firstPill.classList.add('yellow'); // Add yellow class
        }

        // Update the text content
        levelElement.textContent = newLevel;

        // Repeat for the second pill if needed
        if (pillElements.length > 1) {
            const secondPill = pillElements[1];
            const secondLevelElement = secondPill.querySelector('.num');
            const secondCostElement = secondPill.querySelector('.k');

            // Update the second pill
            secondLevelElement.textContent = newLevel;
        }
    }

function buyFarm(farmTypeId) {
    // Prepare the data to send
    const data = {
        farm_type_id: farmTypeId
    };
    // Make a POST request to the server
    axios.post('/buy-farm/', data, {
        headers: {
            'X-CSRFToken': getCookie('csrftoken'), // Include CSRF token
        }
    })
    .then(response => {
        if (response.data.status === 'ok') {
            console.log(response.data)
            // Update the UI or notify the user of success
            berries_per_sec = parseInt(response.data['berries_per_sec'])
            document.getElementById('berries-per-sec').textContent = berries_per_sec
            document.getElementById('total-points').textContent = response.data.balance
            updateFarmLevel(farmTypeId, response.data['new_level']);
        }
    })
    .catch(error => {
    });
}
document.querySelectorAll('.buy-farm-button').forEach(button => {
    button.addEventListener('click', function() {
        const farmTypeId = this.getAttribute('data-farm-type-id'); // Assuming the button has a data attribute for farm type ID
        buyFarm(farmTypeId);
    });
});


function incrementBerries() {
    const currentBerriesElement = document.getElementById('total-points');
    let currentBerries = parseInt(currentBerriesElement.textContent);
    currentBerries += berries_per_sec
    currentBerriesElement.textContent = currentBerries;
}

setInterval(incrementBerries, 1000);
</script>
{% endblock %}
